# Документирование архитектурных решений

Он же: Title.

## Обстановка

Она же: Контекст, Context, Текущая ситуация, Problem Statement.

Развитие любого проекта это поиск компромиссов, обсуждения и череда принятых решений. Часто информация о причинах выбора того или иного направления теряется или забывается. Особенно ситуацию усложняют различные средства связи, устное общение и текучка кадров.

Подобная ситуация таит в себе множество проблем:

- продукт не может развиваться предсказуемо и консистентно, если заложенные в его основу идеи теряются со временем
- любая смена технологий может встретить «забытые» проблемы, которые неявно закрывала предшественница, что приведёт к боязни изменений
- новым специалистам придётся каждый раз объяснять причины выбора той или иной технологии

### Цель

Она же: Мотивация, Задача.

Мы хотим сохранить причины принятых архитектурных решений для истории. Предоставить к этим знаниям удобный доступ, поиск и формализовать структуру. Так же нам нужно выработать процесс принятия решений.

### Варианты

Они же: Considered Options

Для решения поставленных задач существуют общепризнанные подходы RFC (Request for comments) и ADR (Architecture decision records). Первый описывает процесс жизненного цикла из предложений по изменению, а второй нужен для исторического описания итогового решения.

#### Используемые информационные источники

Этот документ был собран из богатого опыта коллег:

- [Michael Nygard «Documenting Architecture Decisions»](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions)
- [MADR – The Markdown Architectural Decision Records](https://adr.github.io/madr/)
- [Евгений Биккинин «Типичные ошибки архитектора, или Как перестать бояться и полюбить RFC»](https://habr.com/ru/company/dododev/blog/578052/)
- [Joel Parker Henderson «Architecture decision record (ADR)»](https://github.com/joelparkerhenderson/architecture-decision-record/blob/main/README.md)

## Решение

Оно же: Decision.

Мы будем следовать RFC подходу для внесения важных изменений в систему. В качестве платформы для предложений и сбора обратной связи будем использовать GitHub Issues. У всех желающих есть 2 недели для высказывания своих точек зрения в комментариях к RFC. Если появляются спорные ситуации, то рекомендуется созвониться всем заинтересованным. Результаты всех обсуждений (созвонов) должны быть добавлены в RFC. После учёта всех комментариев RFC должно быть принято или отклонено. В случае принятия, из него формируется ADR. Если было принято решение об отклонении, необходимо указать причины. После этого жизненный цикл RFC заканчивается, issue закрывается.

Мы будем писать ADR с подробной информацией о принятых решениях. Все документы будут храниться в репозитории проекта в папке с документацией. Каждый ADR должен храниться в отдельном файле в формате [template.md](template.md). Для секции «Решение» необходимо использовать утвердительные предложения (не «Я думаю, что лучше сделать вот так», а утверждения «Мы будем делать вот так»).

### Заметки

Обычно вместе с ADR предлагается использовать различные информационные поля. От большинства из них мы отказываемся.

#### Участники и даты

Они же: Deciders, Date.

Автор RFC и все участники дискуссии будут указаны в GitHub Issue автоматически. Автор ADR и все связанные даты изменений предоставит нам Git.


#### Состояние

Оно же: Статус, Status.

В большинстве случаев это поле будет избыточным. Его можно вывести из жизненных циклов соответствующих документов.

- Предложен (Proposed) — в системе создан RFC
- Принят (Accepted) — в репозитории создан ADR
- Отклонён (Rejected) — RFC закрыт, но ADR не появился
- Замещён (Superseded) — этот статус никак не вывести, его необходимо явно указывать в старом ADR с обязательной ссылкой на новый ADR
- Устарел (Deprecated) — этот статус никак не вывести, его необходимо явно указывать в ADR с обязательным описанием причины.

## Последствия

Они же: Consequences.

Все важные архитектурные решения должны проходить через RFC и оформляться в ADR. Важными считаются:

- новый компонент: сервис, библиотека, нагруженный endpoint
- нужно что-то переписать с нуля
- изменения затронут 2+ команд или 1+ систему
- изменения невозможно или очень дорого откатить
- делаем контракт между системами
- добавляем или убираем что-то из стека
- есть сомнения, что нужно написать RFC

### Достоинства

Они же: Positive Consequences

- Архитектурные решения никогда не будут потеряны
- Документация по важным вехам развития продукта
- Удобное место для поиска и версионирования документации
- Прозрачный процесс предложения изменений со сбором обратной связи
- Понятный формат описания документов

### Недостатки

Они же: Negative Consequences

- Бюрократия на внесение больших изменений в систему
- Работа по оформлению и сопровождению архитектурных документов

